CREATE DOMAIN CLINICA.ID_PACIENTE AS CHAR(6) NOT NULL
	CHECK (VALUE ~ '^[P]{1}[-]{1}\d{4}$'); 

CREATE DOMAIN CLINICA.ID_MEESPECIALISTA AS CHAR(7) NOT NULL
	CHECK (VALUE ~ '^[ME]{2}[-]{1}\d{4}$');
	
CREATE DOMAIN CLINICA.ID_CITA AS CHAR(7) NOT NULL
	CHECK (VALUE ~ '^[CM]{2}[-]{1}\d{4}$'); 

CREATE TABLE CLINICA.PACIENTE (
	pk_idPaciente CLINICA.ID_PACIENTE,
	nombre VARCHAR(20) NOT NULL,
	apellido VARCHAR(20) NOT NULL,
	sexo CHAR(1) NOT NULL,
	fechaNacimiento DATE NOT NULL,
	ciudad VARCHAR(20) NOT NULL,
	estado VARCHAR(20) NOT NULL,
	telefono CHAR(10) UNIQUE,
	PRIMARY KEY (pk_idPaciente)
);

CREATE TABLE CLINICA.ESPECIALISTA(
	pk_idEspecialista CLINICA.ID_MEESPECIALISTA,
	nombre VARCHAR(20) NOT NULL,
	apellido VARCHAR(20) NOT NULL,
	sexo CHAR(1) NOT NULL,
	fechaNacimiento DATE NOT NULL,
	especialidad VARCHAR(30) NOT NULL,
	PRIMARY KEY (pk_idEspecialista)
);

CREATE TABLE CLINICA.EXPEDIENTE (
	pk_idPaciente CLINICA.ID_PACIENTE,
	tipoSangre VARCHAR(10) NOT NULL,
	tipoAlergia VARCHAR(50) NOT NULL,
	padecimientoCro VARCHAR(50) NOT NULL,
	fechaCreacion TIMESTAMP NOT NULL,
	PRIMARY KEY (pk_idPaciente),
	FOREIGN KEY (pk_idPaciente) REFERENCES CLINICA.PACIENTE(pk_idPaciente)
	ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE CLINICA.EXPEDIENTE_DIAGNOSTICO(
	folio SERIAL NOT NULL,
	fk_idEspecialista CLINICA.ID_MEESPECIALISTA,
	fk_idPaciente CLINICA.ID_PACIENTE,
	edad CHAR(3) NOT NULL,
	peso CHAR(3) NOT NULL,
	altura CHAR(4) NOT NULL,
	IMC CHAR(5) NOT NULL,
	nivelPeso CHAR(10) NOT NULL,
	presionArterial CHAR(8) NOT NULL,
	diagnostico VARCHAR(150) NOT NULL,
	recetario VARCHAR(150) NOT NULL,
	fechaCreacion TIMESTAMP NOT NULL,
	PRIMARY KEY (folio),
	FOREIGN KEY (fk_idEspecialista) REFERENCES CLINICA.ESPECIALISTA(pk_idEspecialista)
	ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (fk_idPaciente) REFERENCES CLINICA.EXPEDIENTE(pk_idPaciente)
	ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE CLINICA.CITA (
	pk_idCita CLINICA.ID_CITA,
	fk_idPaciente CLINICA.ID_PACIENTE,
	fecha DATE NOT NULL,
	hora TIME NOT NULL,
	PRIMARY KEY (pk_idCita),
	FOREIGN KEY (fk_idPaciente) REFERENCES CLINICA.PACIENTE(pk_idPaciente)
	ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE CLINICA.AGENDAR_CITA(
	fk_idCita CLINICA.ID_CITA,
	fk_idEspecialista CLINICA.ID_MEESPECIALISTA,
	consultario VARCHAR(20) NOT NULL,
	fechaCita DATE NOT NULL,
	horaCita TIME NOT NULL,
	turno VARCHAR(10) NOT NULL,
	status VARCHAR(10) NOT NULL,
	observaciones VARCHAR(100) NOT NULL,
	PRIMARY KEY (fk_idCIta, fk_idEspecialista),
	FOREIGN KEY (fk_idCita) REFERENCES CLINICA.CITA (pk_idCita)
	ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (fk_idEspecialista) REFERENCES CLINICA.ESPECIALISTA(pk_idEspecialista)
	ON UPDATE CASCADE ON DELETE CASCADE
);




--- AGREGAR Y BORRAR COLUMNAS

ALTER TABLE CLINICA.PACIENTE ADD COLUMN EJEMPLO VARCHAR(29);

SELECT * FROM clinica.paciente;

ALTER TABLE clinica.paciente DROP COLUMN EJEMPLO;

ALTER TABLE clinica.paciente ALTER COLUMN EJEMPLO TYPE CHAR(40);


-- RENOMBRAR

ALTER TABLE clinica.paciente RENAME COLUMN EJEMPLO TO EJEMPLO_NUEVO;

ALTER TABLE clinica.paciente RENAME TO PACIENTE_NUEVO;


-- BORRAR TABLAS

DROP TABLE CLINICA.paciente CASCADE -- ELIMINA UNA TABLA QUE DEPENDA DE OTRA


--INSERTAR DATOS DE PACIENTE

INSERT INTO CLINICA.PACIENTE VALUES 
('P-0001', 'DANIEL', 'CARMONA', 'M', '1998-12-07', 'MEXICO', 'MEXICO', '551234567'),
('P-0002', 'JUAN', 'HERNANDEZ', 'M', '1990-07-21', 'MONTERREY', 'NUEVO LEON', '551234321'),
('P-0003', 'FERNANDA', 'MORALES', 'F', '1973-07-01', 'MEXICO', 'MEXICO', '5412309872'),
('P-0004', 'ANDREA', 'ZUÑIGA', 'F', '2000-12-02', 'GUADALAJARA', 'JALISCO', '3309876522'),
('P-0005', 'ALBERTO', 'PEREYRA', 'M', '1986-10-23', 'MEXICO', 'MEXICO', '5565423983'),
('P-0006', 'KAREN', 'SOTO', 'F', '1978-07-07', 'MEXICO', 'MEXICO', '5565423097'),
('P-0007', 'ANDRES', 'ORTIZ', 'M','1990-10-09', 'MONTERREY', 'MEXICO', '5698782347'),
('P-0008', 'LESLY', 'RODRIGUEZ', 'F', '2001-02-11', 'MEXICO', 'MEXICO', '5543454352'),
('P-0009', 'ENRIQUE', 'VERA', 'M', '1996-11-12', 'GUADALAJARA', 'JALISCO', '3309815273'),
('P-0010', 'VICTORIA', 'SOLIS', 'F', '2002-03-10', 'MEXICO', 'MEXICO', '5565278126');

--INSERTAR DATOS DE ESPECIALISTA

INSERT INTO CLINICA.ESPECIALISTA VALUES 
('ME-0001', 'REYNA', 'GUADALUPE', 'F', '1986-01-01', 'MEDICO GENERAL'),
('ME-0002', 'ENRIQUE', 'ORTIZ', 'M', '1968-10-01', 'NEFROLOGIA'),
('ME-0003', 'FELIPE', 'HERNANDEZ', 'M', '1980-10-02', 'MEDICO GENERAL'),
('ME-0004', 'KENIA', 'LOPEZ', 'F', '1973-01-01', 'PEDIATRA'),
('ME-0005', 'JUAN', 'MARTINEZ', 'M', '1980-02-23', 'MEDICO GENERAL');

--INSERTAR DATOS DE CITA

INSERT INTO CLINICA.CITA VALUES 
('CM-0001', 'P-0001', '2022-10-01', '12:00'),
('CM-0002', 'P-0002', '2022-10-01', '12:20'),
('CM-0003', 'P-0003', '2022-10-02', '12:20'),
('CM-0004', 'P-0004', '2022-10-02', '10:00'),
('CM-0005', 'P-0005', '2022-10-03', '08:20'),
('CM-0006', 'P-0006', '2022-10-03', '12:20'),
('CM-0007', 'P-0007', '2022-10-04', '12:20'),
('CM-0008', 'P-0008', '2022-10-04', '10:00'),
('CM-0009', 'P-0009', '2022-10-04', '08:20'),
('CM-0010', 'P-0010', '2022-10-05', '08:20');

--INSERTAR DATOS DE AGENDAR CITA

INSERT INTO CLINICA.AGENDAR_CITA VALUES 
('CM-0001', 'ME-0001', 'CONSULTORIO 1', '2022-10-04', '12:00', 'MATUTINO', 'ESPERA', 'NA'),
('CM-0002', 'ME-0001', 'CONSULTORIO 1', '2022-10-04', '12:20', 'MATUTINO', 'ESPERA', 'NA'),
('CM-0003', 'ME-0002', 'CONSULTORIO 2', '2022-10-05', '12:00', 'MATUTINO', 'ESPERA', 'NA'),
('CM-0004', 'ME-0002', 'CONSULTORIO 2', '2022-10-05', '12:00', 'MATUTINO', 'ESPERA', 'NA'),
('CM-0005', 'ME-0003', 'CONSULTORIO 3', '2022-10-06', '12:00', 'MATUTINO', 'ESPERA', 'NA'),
('CM-0006', 'ME-0003', 'CONSULTORIO 3', '2022-10-07', '14:00', 'VESPERTINO', 'ESPERA', 'NA'),
('CM-0007', 'ME-0003', 'CONSULTORIO 3', '2022-10-07', '14:20', 'VESPERTINO', 'ESPERA', 'NA'),
('CM-0008', 'ME-0004', 'CONSULTORIO 4', '2022-10-08', '13:00', 'VESPERTINO', 'ESPERA', 'NA'),
('CM-0009', 'ME-0004', 'CONSULTORIO 4', '2022-10-08', '13:20', 'VESPERTINO', 'ESPERA', 'NA'),
('CM-0010', 'ME-0005', 'CONSULTORIO 5', '2022-10-08', '15:00', 'VESPERTINO', 'ESPERA', 'NA');


--INSERTAR DATOS DE EXPEDIENTE

INSERT INTO CLINICA.EXPEDIENTE VALUES
('P-0001', 'B POSITIVO', 'NA', 'NA', '2022-06-10'),
('P-0002', 'B NEGATIVO', 'ALERGIA AL POLVO', 'NA', '2022-06-10'),
('P-0003', 'O NEGATIVO', 'NA', 'DIABETES', '2022-06-14'),
('P-0004', 'B POSITIVO', 'ALERGIA A LOS MARISCOS', 'ASMA', '2022-06-15'),
('P-0005', 'B POSITIVO', 'NA', 'DIABETES', '2022-06-16'),
('P-0006', 'B POSITIVO', 'ALERGIA AL POLVO', 'NA', '2022-06-17'),
('P-0007', 'B POSITIVO', 'NA', 'CANCER', '2022-06-20'),
('P-0008', 'B POSITIVO', 'NA', 'NA', '2022-06-24'),
('P-0009', 'B POSITIVO', 'NA', 'NA', '2022-07-02'),
('P-0010', 'B POSITIVO', 'NA', 'NA', '2022-07-06');


--INSERTAR DATOS DE EXPEDIENTE_DIAGNOSTICO
INSERT INTO CLINICA.EXPEDIENTE_DIAGNOSTICO 
(fk_idespecialista, fk_idpaciente, edad, peso, altura, imc, nivelpeso, presionarterial, diagnostico, recetario, fechacreacion)
VALUES 
('ME-0001', 'P-0001', '24', '70', '1.70', '24.0', 'NORMAL', '120/70', 'NA', 'NA', '2022-11-22'),
('ME-0001', 'P-0002', '33', '80', '1.77', '27.0', 'SOBREPESO', '125/73', 'NA', 'NA', '2022-11-23'),
('ME-0001', 'P-0003', '45', '62', '1.64', '26.6', 'NORMAL', '130/70', 'NA', 'NA', '2022-11-24'),
('ME-0002', 'P-0003', '45', '62', '1.64', '26.6', 'NORMAL', '129/70', 'NA', 'NA', '2022-11-24'),
('ME-0002', 'P-0004', '23', '65', '1.60', '23.0', 'NORMAL', '125/70', 'NA', 'NA', '2022-11-25'),
('ME-0003', 'P-0005', '37', '90', '1.77', '29.0', 'OBESIDAD', '129/80', 'NA', 'NA', '2022-11-25'),
('ME-0003', 'P-0005', '37', '90', '1.77', '29.0', 'OBESIDAD', '128/78', 'NA', 'NA', '2022-11-25'),
('ME-0003', 'P-0006', '46', '72', '1.68', '24.0', 'NORMAL', '120/69', 'NA', 'NA', '2022-11-26'),
('ME-0003', 'P-0007', '31', '76', '1.77', '24.0', 'NORMAL', '125/73', 'NA', 'NA', '2022-11-27'),
('ME-0004', 'P-0007', '31', '76', '1.77', '24.0', 'NORMAL', '125/67', 'NA', 'NA', '2022-11-27'),
('ME-0004', 'P-0008', '21', '68', '1.63', '24.0', 'NORMAL', '119/69', 'NA', 'NA', '2022-11-29'),
('ME-0005', 'P-0009', '26', '90', '1.75', '29.0', 'SOBREPESO', '132/76', 'NA', 'NA', '2022-12-01'),
('ME-0005', 'P-0009', '26', '90', '1.75', '29.0', 'SOBREPESO', '130/74', 'NA', 'NA', '2022-12-01'),
('ME-0005', 'P-0010', '18', '60', '1.59', '23.0', 'NORMAL', '120/68', 'NA', 'NA', '2022-12-02'),
('ME-0005', 'P-0010', '18', '60', '1.59', '23.0', 'NORMAL', '119/65', 'NA', 'NA', '2022-12-02');

--CONSULTAS
SELECT * FROM CLINICA.PACIENTE;
SELECT * FROM CLINICA.ESPECIALISTA;
SELECT * FROM CLINICA.CITA;
SELECT * FROM CLINICA.AGENDAR_CITA;
SELECT * FROM CLINICA.EXPEDIENTE;
SELECT * FROM CLINICA.EXPEDIENTE_DIAGNOSTICO;


-- UPDATE

UPDATE CLINICA.paciente SET estado = 'MEXICO' WHERE pk_idpaciente = 'P-0004';


-- OPERADOR AND / OR

UPDATE CLINICA.paciente SET estado = 'MEXICO' WHERE SEXO = 'M' AND ESTADO = 'MEXICO';
UPDATE CLINICA.paciente SET estado = 'MEXICO' WHERE SEXO = 'M' OR ESTADO = 'MEXICO';


-- ELIMINAR REGISTROS

DELETE FROM CLINICA.paciente WHERE pk_idpaciente = 'P-0009'
DELETE FROM clinica.paciente;
SELECT * FROM CLINICA.expediente

-- CONSULTAS

SELECT nombre, apellido FROM CLINICA.paciente;
SELECT * FROM CLINICA.paciente WHERE CIUDAD IN ('MONTERREY', 'GUADALAJARA');
SELECT * FROM clinica.paciente WHERE APELLIDO LIKE '%Z';
SELECT * FROM clinica.paciente WHERE APELLIDO LIKE 'Z%';

SELECT * FROM CLINICA.expediente_diagnostico WHERE EDAD <= '23';


-- FUNCIONES DE AGREGACION
SELECT COUNT(*) AS CANTIDAD_PACIENTE FROM clinica.paciente WHERE CIUDAD = 'MEXICO';

-- SUM
SELECT sum(folio) FROM CLINICA.expediente_diagnostico;
SELECT sum(cast(edad as int)) as suma_edad FROM CLINICA.expediente_diagnostico;


-- MAX Y MIN
SELECT max(cast (edad as int)) FROM CLINICA.expediente_diagnostico;


-- AVG
SELECT AVG(CAST (EDAD AS INT)) AS MEDIA_EDAD FROM CLINICA.expediente_diagnostico;


-- COMBINAR FUNCIONES DE AGREGACION
SELECT MAX(EDAD) AS EDAD_MAXIMA, MIN(EDAD) AS EDAD_MINIMA, SUM(CAST(EDAD AS INT)) AS EDAD_SUM,
AVG(CAST(EDAD AS INT)) AS EDAD_PROMEDIO, COUNT(*) AS CANTIDAD_DIAG FROM CLINICA.expediente_diagnostico;

-- GROUP BY AND ORDER BY
SELECT fk_idEspecialista FROM clinica.expediente_diagnostico GROUP BY fk_idEspecialista

SELECT COUNT(nivelPeso) AS cantidad_peso, nivelPeso FROM CLINICA.expediente_diagnostico GROUP BY nivelPeso 
ORDER BY cantidad_Peso desc;


-- HAVING
SELECT fk_idEspecialista, COUNT(fk_idEspecialista) AS CITAS_A_REALIZAR
FROM clinica.expediente_diagnostico 
GROUP BY fk_idEspecialista 
HAVING COUNT(fk_idEspecialista) > 1;


-- DISTINCT
SELECT DISTINCT fk_idEspecialista
FROM clinica.expediente_diagnostico order by fk_idespecialista

-- LIMIT
SELECT * FROM CLINICA.expediente_diagnostico ORDER BY FOLIO DESC LIMIT 1;

-- JOIN 
SELECT * FROM CLINICA.PACIENTE 
INNER JOIN CLINICA.EXPEDIENTE 
ON PACIENTE.pk_idPaciente = EXPEDIENTE.pk_idPaciente
WHERE PACIENTE.pk_idPaciente = 'P-0001';


SELECT * FROM CLINICA.PACIENTE
LEFT JOIN CLINICA.EXPEDIENTE
ON PACIENTE.pk_idPaciente = EXPEDIENTE.pk_idPaciente


SELECT * FROM CLINICA.PACIENTE
RIGHT JOIN CLINICA.EXPEDIENTE
ON PACIENTE.pk_idPaciente = EXPEDIENTE.pk_idPaciente

SELECT* FROM CLINICA.PACIENTE
INNER JOIN CLINICA.CITA
ON PACIENTE.pk_idPaciente = CITA.fk_idPaciente
INNER JOIN CLINICA.AGENDAR_CITA
ON CITA.pk_idCita = AGENDAR_CITA.fk_idCITA
INNER JOIN CLINICA.ESPECIALISTA
ON AGENDAR_CITA.fk_idEspecialista = ESPECIALISTA.pk_idEspecialista
WHERE PACIENTE.pk_idPaciente = 'P-0001';



-- CREAR Y ELIMINAR VISTA
CREATE VIEW CLINICA.PACIENTES_MASCULINOS AS 
SELECT * FROM CLINICA.PACIENTE WHERE SEXO = 'M';

SELECT * FROM CLINICA.PACIENTES_MASCULINOS;

DROP VIEW CLINICA.PACIENTES_MASCULINOS;



-- SUBCONSULTAS

SELECT * FROM CLINICA.ESPECIALISTA
WHERE pk_idEspecialista IN (SELECT fk_idEspecialista 
							FROM CLINICA.AGENDAR_CITA
							WHERE fechaCita BETWEEN '2022-10-04' and '2022-10-08');



SELECT * FROM CLINICA.PACIENTE
INNER JOIN CLINICA.EXPEDIENTE_DIAGNOSTICO
ON PACIENTE.pk_idPaciente = EXPEDIENTE_DIAGNOSTICO.fk_idPaciente
WHERE SEXO = 'M'
AND EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista IN (SELECT pk_idEspecialista
												 FROM CLINICA.ESPECIALISTA
												 WHERE pk_idEspecialista in ('ME-0001'));


-- FUNCIONES DE TEXTO

SELECT LEFT('HOLA ESTE ES UN MENSAJE',4) AS MENSAJE

SELECT nombre, apellido from clinica.paciente where left (nombre,1) = 'D';


SELECT RIGHT('HOLA ESTE ES UN MENSAJE',4) AS MENSAJE

SELECT nombre, apellido from clinica.paciente where RIGHT (APELLIDO,1) = 'Z';


SELECT CONCAT ('PACIENTE CON ID: ', fk_idPaciente, ' tiene un peso de ' , peso, ' kg')
from clinica.expediente_diagnostico;


SELECT (NOMBRE || ' ' || APELLIDO) FROM CLINICA.PACIENTE;

SELECT LENGTH(NOMBRE || ' ' || APELLIDO) FROM CLINICA.PACIENTE;

UPDATE CLINICA.expediente SET tiposangre = replace (tiposangre , 'B','O') WHERE tipoalergia = 'NA'
and padecimientocro = 'NA';



-- FECHA Y HGORA

SELECT NOW();
SELECT CURRENT_TIME;



--1.- SELECCIONAR LOS PACIENTE CUYOS NOMBRES TERMINEN CON UNA A O QUE SUS APELLIDOS TERMINEN CON UNA Z
--ORDENARLOS POR SU ID DE FORMA DESCENDENTE.

SELECT * FROM CLINICA.PACIENTE
WHERE nombre LIKE '%A' OR apellido LIKE '%Z'
ORDER BY pk_idPaciente;

--2.- CONTAR LOS ESPECIALISTAS Y AGRUPARLOS POR SU ESPECIALIDAD
--RENOMBRAR COLUMNA EN CASO QUE SEA NECESARIO

SELECT COUNT(pk_idEspecialista) AS cantidad_especialistas, especialidad FROM CLINICA.ESPECIALISTA
GROUP BY especialidad;

--3.- SELECCIONAR LOS EXPEDIENTES DIAGNOSTICOS CUYO peso sea mayor a 50 o la edad mayor a 30

SELECT fk_idPaciente, edad, peso, altura FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
WHERE (peso < '50' OR edad > '30')

--4.- SELECCIONAR LAS LLAVES FORANEAS DE PACIENTE Y ESPECIALISTA UTILIZANDO LA INSTRUCCION DISTINCT DE LA TABLA DE EXPEDIENTE DIAGNOSTICO

SELECT DISTINCT (fk_idPaciente, fk_idEspecialista)  
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO;

--5.- SELECCIONAR LAS COLUMNAS DE FOLIO, ID DE PACIENTE, ID DE ESPECIALISTA Y FECHA DE CREACION 
--LOS DIAGNOSTICOS DE LOS PACIENTE QUE TENGAN UNA EDAD MAYOR A 25 Y SU NIVEL DE PESO NO SEA NORMAL,
--ADEMÁS QUE SU FECHA DE DIAGNOSTICO SEA MAYOR A FEBREO DEL 2021, ORDENARLOS POR EL ID DE ESPECIALISTA. 

SELECT folio, fk_idPaciente, fk_idEspecialista, fechaCreacion FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
WHERE nivelPeso NOT IN ('NORMAL') AND edad > '25' AND fechaCreacion > '2021-02-01'
GROUP BY folio
ORDER BY fk_idEspecialista;

--6.- SELECCIONAR LOS ESPECIALISTAS QUE HAYAN HECHO DIAGNOSTICOS CUYO NIVEL DE PESO SEA SOBREPESO.

SELECT * FROM CLINICA.ESPECIALISTA
WHERE pk_idEspecialista IN (SELECT fk_idEspecialista
							FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
							WHERE nivelPeso IN ('SOBREPESO'));


--7.- SELECCIONAR CUÁNTOS DIAGNOSTICOS TIENEN CADA PACIENTE INGRESADO Y AGRUPARLOS POR SU ID, ORDENARLO LA CANTIDAD DE CITAS DE MAYOR A MENOR

SELECT fk_idPaciente, COUNT(fk_idPaciente) AS cantidad_citas
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
GROUP BY fk_idPaciente ORDER BY COUNT(fk_idPaciente) DESC;


--8.- SELECCIONA LOS EXPEDIENTES DE LOS PACIENTES QUE TENGAN NIVELES DE PESO EN NORMAL Y SOBREPESO, 
ADEMÁS QUE LOS HAYAN ATENDIDO LOS ESPECIALISTA CUYA ESPECIALIDAD NO SEA DE MEDICO GENERAL

SELECT * FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
WHERE nivelPeso IN('NORMAL','SOBREPESO') 
AND fk_idEspecialista IN (SELECT pk_idEspecialista FROM CLINICA.ESPECIALISTA
						 WHERE especialidad NOT IN ('MEDICO GENERAL'))


--9.- SELECCIONAR LOS PACIENTES QUE VIVAN EN LA CIUDAD DE MEXICO Y QUE HALLAN NACIDE DEPUES DE 1990, 
--ADEMÁS QUE NO TENGAN ALERGÍAS O PADECIMIENTOS CRONICOS
--POR ÚLTIMO QUE HALLAN RECIBIDO DIAGNOSTICOS DE LOS ESPECIALISTAS CUYOS ID SEAN: ME-0001, ME-0002 Y ME-0003 

SELECT * FROM CLINICA.PACIENTE 
WHERE ciudad = 'MEXICO' AND fechaNacimiento <= '1990-01-01' 
AND pk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.EXPEDIENTE
					  WHERE tipoAlergia = 'NA' OR padecimientoCro = 'NA')
AND pk_idPaciente IN (SELECT fk_idPaciente FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
					  WHERE fk_idEspecialista IN('ME-0001', 'ME-0002', 'ME-0003'));	


--10.- SELECCIONAR MEDIANTE UN INNER JOIN ANIDADO LAS TABLAS DE PACIENTE, CITA, AGENDAR_CITA Y ESPECIALISTA
--ADEMÁS REALIZAR DENTRO DEL JOIN UNA SUBCONSULTA PARA SABER LOS DIAGNOSTICOS DE LOS PACIENTES
--QUE TENGAN UN PESO MAYOR A 70 O UNA EDAD MAYOR A 20

SELECT * FROM CLINICA.PACIENTE
INNER JOIN CLINICA.CITA
ON PACIENTE.pk_idPaciente = CITA.fk_idPaciente
INNER JOIN CLINICA.AGENDAR_CITA
ON CITA.pk_idCita = AGENDAR_CITA.fk_idCita
INNER JOIN CLINICA.ESPECIALISTA
ON AGENDAR_CITA.fk_idEspecialista = ESPECIALISTA.pk_idEspecialista
WHERE PACIENTE.pk_idPaciente IN (SELECT pk_idPaciente 
								 FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
								 WHERE peso >  '70' OR edad > '20');


--11.- SELECCIONAR LOS DIAGNOSTICOS, ADEMÁS EXTRAER LOS PACIENTES QUE SEAN DE SEXO MASCULINO,
--POR ÚLTIMO EXTRAER LAS COLUMNAS DE NOMBRE, APELLIDO Y ESPECIALIDAD DE LA TABLA DE ESPECIALISTA

SELECT *,(SELECT nombre FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista),
(SELECT apellido FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista),
(SELECT especialidad FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista)
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
WHERE fk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.PACIENTE
					   WHERE sexo = 'M')

--12.-MEDIANTE UN INNER JOIN SELECCIONAR LAS TABLAS DE PACIENTE CITA Y AGENDAR CITA, EN DONDE LA FECHA DE CITA ESTE ENTRE DOS FECHAS
ADEMÁS QUE LAS CIUDADES DE LOS PACIENTES SEAN MEXICO O MONTERREY, POR ULTIMO QUE EL TIPO DE SANGRE DE LOS PACIENTES SEA O POSITIVO

SELECT * FROM CLINICA.PACIENTE
INNER JOIN CLINICA.CITA
ON PACIENTE.pk_idPaciente = CITA.fk_idPaciente
INNER JOIN CLINICA.AGENDAR_CITA
ON CITA.pk_idCita = AGENDAR_CITA.fk_idCita
WHERE AGENDAR_CITA.fechaCita BETWEEN '2022-10-04' AND '2022-10-08'
AND PACIENTE.ciudad IN('MEXICO', 'MOTERREY')
AND PACIENTE.pk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.EXPEDIENTE
							  WHERE tipoSangre ='O POSITIVO')
								 
					
